{{>layout/header}}
<link rel="stylesheet" href="/css/index-style.css">
<section class="container">
    <div id="demo" class="carousel slide" data-bs-ride="carousel"
         style="margin-top: 30px; border: 5px solid rgba(255, 255, 255, 0.3)">

        <!-- Indicators/dots -->
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#demo" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#demo" data-bs-slide-to="2"></button>
        </div>

        <!-- The slideshow/carousel -->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <a href="https://example.com/link1" target="_blank">
                    <div class="carousel-caption">
                        <h5>title</h5>
                        <p>addr1</p>
                    </div>
                    <img src="/images/slide1.jpg" alt="Los Angeles" class="d-block"
                         style="width:100%; height:380px;">
                </a>
            </div>
        </div>

        <!-- Left and right controls/icons -->
        <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="placeInfo__box">
        <div class="place_title">
            <div>Today's</div>
            <div> ì¶”ì²œ ì—¬í–‰ì§€</div>
        </div>
        <ul class="nav__content" style="margin: 10px;">
            <li class="nav__item"><span onclick="areaClick('all',this)" class="nav__link" id="defaultItem">ì „êµ­</span></li>
            <li class="nav__item"><span onclick="areaClick('1',this)" class="nav__link">ì„œìš¸</span></li>
            <li class="nav__item"><span onclick="areaClick('2',this)" class="nav__link">ì¸ì²œ</span></li>
            <li class="nav__item"><span onclick="areaClick('3',this)" class="nav__link">ëŒ€ì „</span></li>
            <li class="nav__item"><span onclick="areaClick('4',this)" class="nav__link">ëŒ€êµ¬</span></li>
            <li class="nav__item"><span onclick="areaClick('5',this)" class="nav__link">ê´‘ì£¼</span></li>
            <li class="nav__item"><span onclick="areaClick('6',this)" class="nav__link">ë¶€ì‚°</span></li>
            <li class="nav__item"><span onclick="areaClick('7',this)" class="nav__link">ìš¸ì‚°</span></li>
            <li class="nav__item"><span onclick="areaClick('39',this)" class="nav__link">ì œì£¼</span></li>
        </ul>
        <div class="image__gallery">
            <div class="image__card">
                <img src="/images/maincard1.jpg" alt="Card 1">
                <div class="card__text"></div>
            </div>
            <div class="image__card">
                <img src="/images/maincard2.jpg" alt="Card 2">
                <div class="card__text"></div>
            </div>
            <div class="image__card">
                <img src="/images/maincard3.PNG" alt="Card 3">
                <div class="card__text"></div>
            </div>
        </div>
        <div class="see__more" onclick="infoClick()">
            ë”ë³´ê¸° +
        </div>
    </div>
    <div class="travel__info">
        <div class="travel__title">ğŸ ê°€ì„ ì—¬í–‰ì§€ ì¶”ì²œ ğŸ</div>
        <div class="travel__content__box">

            <div class="travel__content1" onclick="detailClick('2508220')">
                <img src="/images/maincard4.jpg">
                <div class="travel__side__box">
                    <div class="travel__text1">êµ­ë¦½ë°±ë‘ëŒ€ê°„ìˆ˜ëª©ì›</div>
                    <div class="travel__text2">ì„ ì„ í•œ ë‚ ì”¨ì— ê°€ì¡±ì—¬í–‰ìœ¼ë¡œ ë”±</div>
                </div>
            </div>
            <div class="travel__content2" onclick="clickFestival('2746930')">
                <img src="/images/maincard2.jpg">
                <div class="travel__side__box">
                    <div class="travel__text1">ê°ì•…ì‚° ê½ƒë³„ ì—¬í–‰</div>
                    <div class="travel__text2">ë‚®ì—ëŠ” ê°€ì„ì˜ ê½ƒì˜ ì „ê²½ì„, ë°¤ì—ëŠ” ë³„ë¹›ì„</div>
                </div>
            </div>
            <div class="travel__content3" onclick="clickFestival('2648460')">
                <img src="/images/maincard5.png">
                <div class="travel__side__box">
                    <div class="travel__text1">ê²½ë³µê¶ ë³„ë¹›ì•¼í–‰</div>
                    <div class="travel__text2">ë¯¸ì²˜ ì•Œì§€ ëª»í–ˆë˜ ê²½ë³µê¶ì˜ ìƒˆë¡­ê³  ë¹„ë°€ìŠ¤ëŸ° ì´ì•¼ê¸°</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            let url = `get-info?area=all`;

            fetchContent(url);
            slide();
        });

        const defaultItem = document.getElementById("defaultItem");
        defaultItem.classList.add("active");
        let activeItem = defaultItem;

        async function areaClick(areaCode, element){
            if (activeItem) {
                activeItem.classList.remove("active");
            }
            element.classList.add("active");
            activeItem = element;

            let contentUrl = `get-info?area=${areaCode}`;
            await fetchContent(contentUrl);
        }

        async function slide(){
            let url = `get-info?area=all&sortBy=viewCount`;
            let response = await fetch(url);
            let responseBody = await response.json();
            let contentList = responseBody.body.contents;

            console.log("slide",contentList);
            // Select the carousel-inner element
            const carouselInner = document.querySelector('.carousel-inner');
            carouselInner.innerHTML = '';  // Clear the existing carousel items

            // Iterate over contentList and create carousel items
            contentList.forEach((content, index) => {
                const isActive = index === 0 ? 'active' : '';  // Make the first item active

                const carouselItem = `
                <div class="carousel-item ${isActive}">
                    <a href="${content.link}" target="_blank">
                        <div class="carousel-caption">
                            <h5>${content.title}</h5>
                            <p>${content.addr1}</p>
                        </div>
                        <img src="${content.firstImage || '/images/default.jpg'}" alt="${content.title}" class="d-block" style="width:100%; height:380px;">
                    </a>
                </div>
            `;

                // Append the newly created carousel item
                carouselInner.insertAdjacentHTML('beforeend', carouselItem);
            });
        }

        async function fetchContent(url){
            let response = await fetch(url);
            let responseBody = await response.json();
            let contentList = responseBody.body.contents;

            const gallery = document.querySelector('.image__gallery');

            // ê¸°ì¡´ ë‚´ìš©ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            gallery.innerHTML = '';

            // ë‚´ìš© ë°°ì—´ì˜ ì²« 3ê°œ í•­ëª©ì„ ì‚¬ìš©í•˜ì—¬ ì¹´ë“œ ìƒì„±
            for (let i = 4; i < Math.min(7, contentList.length); i++) {
                const content = contentList[i];

                const locationPrefix = content.addr1.substring(0, 2);

                // ì¹´ë“œ HTML ìƒì„±
                const cardHTML = `
                    <div class="image__card" onclick="detailClick('${content.contentId}')">
                        <img src="${content.firstImage}" alt="Card ${i + 1}">
                        <div class="card__text">${locationPrefix} ${content.title}</div>
                    </div>
                `;

                // ê°¤ëŸ¬ë¦¬ì— ì¹´ë“œ ì¶”ê°€
                gallery.insertAdjacentHTML('beforeend', cardHTML);
            }
        }

        function infoClick() {
            location.href = `/info`
        }

        function clickFestival(contentId) {
            location.href = `/festival/detail/${contentId}`;
        }

        function detailClick(contentId) {
            location.href = `/info/detail?contentId=${contentId}`;
        }
    </script>

</section>
{{>layout/footer}}